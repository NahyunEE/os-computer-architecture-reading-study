# 0. CPU란?
![](https://velog.velcdn.com/images/sukk/post/525089bd-60cd-4a7f-a889-4882277a9e45/image.jpeg)
- 명령어를 읽고, 해석하고, 실행하는 부품
- - CPU 구성요소
    
    **ALU(산술논리연산장치)**
    
    - 산술연산(덧셈, 뺄셈 등)과 논리연산(논리합, 논리곱 등)을 계산하는 디지털 회로 [위키백과]
    - 컴퓨터 내부에서 수행되는 대부분의 계산 수행
    
    **레지스터**
    
    - CPU 내부의 고속 임시 저장 장치(메모리)
    - 극소량의 데이터나 처리 중간 결과 등의 CPU가 바로 사용할 수 있는 데이터를 담고 있음 [나무 위키]
    - 여러 개의 레지스터가 존재하고 각기 다른 역할을 가지고 있음
    
    **제어장치**
    
    - 제어신호(control signal)를 내보내고 명령어를 읽고 해석
    - CPU와 다른 장치들 사이의 데이터 흐름 제어
# 1. ALU
![](https://velog.velcdn.com/images/sukk/post/72786eb8-3225-4723-ae99-9bcc872952b7/image.png)
### ALU가 받아들이는 정보

- 계산을 위한 피연산자와 제어신호(연산)을 받아들임
    - 레지스터에서 피연산자를 받아들임
    - 제어 장치에서 제어 신호를 받아들임

### ALU가 내보내는 정보

- 연산의 결과를 내보냄
    - 특정 숫자나 문자, 메모리 주소 → 레지스터에 저장
    - 연산 결과에 대한 추가 적인 상채 정보(=플래그) → 플래그 레지스터에 저장![](https://velog.velcdn.com/images/sukk/post/6a833137-9e0f-4a1a-b367-eb84f011e64a/image.png)

# 2. 제어 장치
![](https://velog.velcdn.com/images/sukk/post/a3a1a7a5-7697-441f-a130-4ce4f2bd2a40/image.png)

### 제어장치가 받아들이는 정보

- 클럭 신호![](https://velog.velcdn.com/images/sukk/post/e33107cb-7713-4193-943d-b590b811e640/image.png)

  - 클럭 주기에 따라
    - 레지스터간 데이터가 이동하거나,
    - ALU에서 연산이 수행되거나,   
    - CPU가 메모리에서 명령어를 읽어들임

- 명령어
    - 명령어 레지스터로부터 해석할 명령어를 받아들이고 해석한 뒤 제어 신호를 발생 시킴
- 플래그 값
    - 명령어를 수행할 때, 연산을 수행할 때 플래그 값을 참고하여 제어 신호를 발생 시킴
- 제어 신호
    - 외부 장치(ex. 입출력장치)가 발생시킨 제어 신호를 제어 버스를 통해 받아들임
### 제어장치가 내보내는 정보

- 제어 신호
    - 레지스터로 전송
        - 레지스터 간에 데이터를 이동시키거나 레지스터에 저장된 명령어를 해석하기 위해
    - ALU로 전송
        - ALU에게 수행할 연산을 지시하기 위해
    - 메모리로 전송
        - 메모리에 저장된 값을 읽거나 메모리에 새로운 값을 쓰려고 할 때
    - 입출력 장치로 전송
        - 입출력장치의 값을 읽거나 새로운 값을 쓰려고 할 대

# 3. 레지스터

- CPU마다 이름, 크기, 종류가 다양하지만 여러 전공 서적에서 공통적으로 중요하게 다루는 레지스터를 공부함
    1. 프로그램 카운터
    2. 명령어 레지스터
    3. 메모리 주소 레지스터
    4. 메모리 버퍼 레지스터
    5. 스택 포인터
    6. 베이스 레지스터
    7. 플래그 레지스터
    8. 범용 레지스터
## 메모리에서 데이터를 읽어올 때 쓰이는 레지스터

### 프로그램 카운터

- 메모리에서 가져올 명령어의 주소를 저장하는 레지스터
- 명령어 포인터(Instruction Pointer)라고 부르는 CPU도 있음

### 명령어 레지스터

- 방금 메모리에서 읽어들인 명령어를 저장하는 레지스터

### 메모리 주소 레지스터

- 메모리의 주소를 저장하는 레지스터
- CPU가 읽어 들이고자하는 주소 값을 주소 버스로 내보낼 때 거치는 레지스터

### 메모리 버퍼 레지스터

- 메모리와 주고받을 값(데이터와 명령어)를 저장하는 레지스터
- 데이터 버스로 주고 받을 값이 거쳐가는 레지스터

### 메모리에서 데이터 읽어오는 과정

1. `프로그램 카운터`에 프로그램의 시작점인 1000번지가 담김
    ![](https://velog.velcdn.com/images/sukk/post/4029a477-97ed-4122-8b56-093e2a63c94a/image.png)


2. 주소 버스로 1000번지를 내보내서 값을 읽어들이기 위해 주소값이 `메모지 주소 레지스터`에 저장됨![](https://velog.velcdn.com/images/sukk/post/902fb2c6-386a-45d5-b07c-1cb51e2aaa87/image.png)
    
    

    
3. 제어 신호는 제어 버스를 통해, 메모리 주소는 주소 버스를 통해 메모리로 전달됨![](https://velog.velcdn.com/images/sukk/post/691f4229-8fb8-49e4-8de5-ad28445771a3/image.png)


    
4. 메모리 1000번지에 저장된 값이 데이터 버스를 통해 `메모리 버퍼 레지스터`에 저장되고 해당 주소에서 값을 가져왔으므로 프로그램 카운터는 다음 명령어의 주소를 저장![](https://velog.velcdn.com/images/sukk/post/6b248468-39c0-45fd-9f32-8737bec6ad52/image.png)

    
5. `메모리 버퍼 레지스터`에 저장된 값이 `명령어 레지스터`로 이동![](https://velog.velcdn.com/images/sukk/post/098a6b48-55fe-4c2b-aab2-18e2dece4e4a/image.png)


## 기타

### 범용 레지스터

- 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터
- 데이터와 주소 모두 저장 가능
- 일반적으로 CPU안에는 여러 개의 범용 레지스터가 있음

### 플래그 레지스터

- 연산 결과 또는 CPU 상태에 대한 부가적인 정보를 저장하는 레지스터

## 레지스터가 사용되는 주소 지정 방식

- `스택 포인터`, `베이스 레지스터`,  `프로그램 카운터`

### 스택 주소 지정 방식

- 스택과 `스택 포인터` 를 이용한 주소 지정 방식
- `스택 포인터` : 스택의 맨 꼭대기를 가리키는 레지스터
- 메모리 내의 스택 영역의 주소를 지정하는 방식

### 변위 주소 지정 방식

- 오퍼랜드 필드의 값(=변위)과 특정 레지스터의 값을 더하여 유효 주소를 얻는 주소 지정 방식
    
    **상대 주소 지정 방식**
    
    - 오퍼랜드와 `프로그램 카운터`의 값을 더하여 유효 주소를 얻는 방식
    - `프로그램 카운터` : 실행하려는 명령어가 저장된 주소
    - 실행하려는 명령어의 주소에서 오퍼랜드만큼 떨어진 주소에 저장된 명령어 실행
    
    **베이스 레지스터 주소 지정 방식**
    
    - 오퍼랜드와 `베이스 레지스터`의 값을 더하여 유효 주소를 얻는 방식
    - `베이스 레지스터` : 기존 주소(ex. 프로그램의 시작 주소) 역할
    - 프로그램의 시작 주소로부터 오퍼랜드만큼 떨어진 주소의 명령어 실행
# 4. 인터럽트

## 명령어 사이클

- 인터럽트가 없을 때의 명령어 사이클![](https://velog.velcdn.com/images/sukk/post/35f8c9f3-d87d-4239-920a-b23cedaf1b33/image.png)

    
    - 인출 사이클 : 메모리에 있는 명령어를 CPU로 가지고 오는 과정
    - 실행 사이클 : CPU로 가져온 명령어를 실행하는 과정
    - 간접 사이클 : 명령어의 오퍼랜드 필드에 유효 주소의 주소가 저장되어 한 번더 메모리에 접근하는 과정

## 인터럽트

- CPU 작업을 방해하는 신호![](https://velog.velcdn.com/images/sukk/post/123ed0a0-a492-41fd-bb2f-8139fdde3a20/image.png)
![](https://velog.velcdn.com/images/sukk/post/0ed1ba42-d743-4058-86b6-97ae9af24d58/image.png)

    

### 인터럽트의 종류

**동기 인터럽트 / 예외(exception)**

- CPU가 명령어를 실행하다가 예상치 못한 상황에 마주치는 경우
    - ex. 프로그래밍상의 오류 같은 예외적인 상황에 마주치는 것
- 예외가 발생하면 CPU는 하던 일을 중단하고 해당 예외를 처리함

**비동기 인터럽트 / 하드웨어 인터럽트**

- 주로 입출력 장치에 의해 발생하는 인터럽트
    - ex. CPU가 프린터에 작업을 부탁하고 작업이 끝나면 프린터가 CPU에게 완료 알림(인터럽트)를 보냄
    - 만약 인터럽트가 없다면 CPU가 계속해서 프린트가 작업을 끝냈는지 확인해야 함, 다른 작업을 못함

## 예외(exception)의 종류

### 폴트

- 예외를 처리한 직후에 예외가 발생한 명령어부터 실행을 재개하는 예외

### 트랩

- 예외를 처리한 직후에 예외가 발생한 명령어의 다음 명령어부터 실행을 재개하는 예외
    
    ex) 디버깅
    

### 중단

- CPU가 실행 중인 프로그램을 강제로 중단시킬 수 밖에 없는 심각한 오류를 발견했을 때 발생하는 예외

### 소프트웨어 인터럽트

- 시스템 호출이 발생했을 때 나타남

## 하드웨어 인터럽트 처리 과정

### 1. 입출력장치가 CPU에 `인터럽트 요청 신호`를 보냄

### 2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 `인터럽트 여부를 확인`

- 인터럽트 여부 확인 : 플래그 레지스터의 `인터럽트 플래그`를 통해 확인

### 3. CPU는 `인터럽트 요청`을 확인하고 `인터럽트 플래그`를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인

- CPU가 중요한 작업을 처리해야 할 때는 `인터럽트 플래그`가 `불가`임 → `불가` 일 때는 인터럽트 무시
- 하지만 정전이나 하드웨어 고장으로 인한 인터럽트 등의 **중요한 인터럽트는 인터럽트 플래그와 상관없이** 처리 함

### 4. 인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작업을 백업
![](https://velog.velcdn.com/images/sukk/post/8c6e84ad-709c-4d7c-b073-4ab6f06e854e/image.png)

![](https://velog.velcdn.com/images/sukk/post/4a7f17f9-bf8c-43a5-8aea-a75a368b4a4f/image.png)

### 5. CPU는 `인터럽트 벡터`를 참조하여 `인터럽트 서비스 루틴`을 실행

- 각각의 입출력장치의 인터럽트 서비스 루틴 프로그램이 있음
- `인터럽트 백터`를 알면 `인터럽트 서비스 루틴`의 시작 주소를 알 수 있음
    
    → 인터럽트 서비스 루틴을 구분하기 위해 인터럽트 벡터 사용
    

### 6. `인터럽트 서비스 루틴` 실행이 끝나면 `4번`에서 백업해둔 작업을 복구하여 실행 재개

## 인터럽트를 포함한 명령어 사이클
![](https://velog.velcdn.com/images/sukk/post/791b50ac-5fc4-41d9-9b8a-19ac90144901/image.png)


## Reference
> - 혼자 공부하는 컴퓨터 구조 + 운영체제 강의 (인프런) - 사진 출처

